<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>預約試教時段</title>
  <style>
    /* 行事曆格子樣式 */
    .schedule {
      margin-top: 1.5rem;
      overflow-x: auto;
    }
    .schedule table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 0 6px rgba(0,0,0,0.05);
    }
    .schedule th, .schedule td {
      border: 1px solid #ddd;
      padding: 0.75rem;
      text-align: center;
      cursor: pointer;
    }
    .schedule th {
      background-color: #f5f5f5;
    }
    .schedule td.available:hover {
      background: #e8eaf6;
    }
    .schedule td.selected {
      background: #3f51b5;
      color: #fff;
      font-weight: bold;
    }
    .form-card {
      margin-top: 2rem;
      background: #fff;
      padding: 1.5rem;
      box-shadow: 0 0 6px rgba(0,0,0,0.05);
      border-radius: 6px;
    }
    .form-card label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }
    .form-card input, 
    .form-card textarea {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
    }
    .submit-btn {
      margin-top: 1rem;
      background: #3f51b5;
      color: #fff;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
    }
    #bookingList {
      margin-top: 2rem;
      overflow-x: auto;
    }
    #bookingList table {
      width: 100%;
      border-collapse: collapse;
    }
    #bookingList th, #bookingList td {
      border: 1px solid #ddd;
      padding: 0.5rem;
      text-align: center;
    }
    #bookingList th {
      background-color: #f5f5f5;
    }
  </style>
</head>
<body>
  <header>
    <h1>家教平台</h1>
  </header>

  <main>
    <h2>選擇試教時段</h2>
    <p>請點選以下表格中的可預約時段，並填寫基本資料：</p>

    <!-- 行事曆 -->
    <div class="schedule">
      <table>
        <thead>
          <tr>
            <th>時間</th>
            <th>週一</th>
            <th>週二</th>
            <th>週三</th>
            <th>週四</th>
            <th>週五</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>09:00 - 10:00</td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td></tr>
          <tr><td>10:00 - 11:00</td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td></tr>
          <tr><td>11:00 - 12:00</td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td></tr>
          <tr><td>12:00 - 13:00</td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td></tr>
          <tr><td>13:00 - 14:00</td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td></tr>
          <tr><td>14:00 - 15:00</td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td></tr>
          <tr><td>15:00 - 16:00</td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td></tr>
          <tr><td>16:00 - 17:00</td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td></tr>
          <tr><td>17:00 - 18:00</td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td></tr>
          <tr><td>18:00 - 19:00</td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td></tr>
          <tr><td>19:00 - 20:00</td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td></tr>
          <tr><td>20:00 - 21:00</td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td><td class="available"></td></tr>
        </tbody>
      </table>
    </div>

    <!-- 學生資訊表單 -->
    <div class="form-card">
      <form id="bookingForm">
        <label for="name">姓名：</label>
        <input type="text" id="name" name="name" required>

        <label for="email">Email：</label>
        <input type="email" id="email" name="email" required>

        <label for="phone">電話：</label>
        <input type="tel" id="phone" name="phone" required>

        <label for="message">備註：</label>
        <textarea id="message" name="message" rows="3"></textarea>

        <button type="submit" class="submit-btn">送出預約</button>
      </form>
    </div>

    <!-- 預約紀錄列表 -->
    <h2>預約紀錄</h2>
    <div id="bookingList">
      <table id="bookingTable">
        <thead>
          <tr>
            <th>姓名</th>
            <th>Email</th>
            <th>電話</th>
            <th>備註</th>
            <th>預約時段</th>
            <th>提交時間</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </main>

  <script>
    const allBookings = [];

    // 點擊切換已選時段
    document.querySelectorAll('.schedule td.available').forEach(cell => {
      cell.addEventListener('click', () => {
        cell.classList.toggle('selected');
      });
    });

    function renderBookingTable() {
      const tbody = document.querySelector("#bookingTable tbody");
      tbody.innerHTML = "";
      allBookings.forEach(b => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${b.name}</td>
          <td>${b.email}</td>
          <td>${b.phone}</td>
          <td>${b.message}</td>
          <td>${b.slots.map(s => s.day + " " + s.time).join("; ")}</td>
          <td>${b.timestamp}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function convertToCSV(arr) {
      const header = ["姓名","Email","電話","備註","預約時段","提交時間"];
      const rows = arr.map(b => [
        b.name, b.email, b.phone, b.message, b.slots.map(s => s.day + " " + s.time).join("; "), b.timestamp
      ]);
      return [header, ...rows].map(r => r.join(",")).join("\n");
    }

    document.getElementById("bookingForm").addEventListener("submit", function(e){
      e.preventDefault();

      const selected = [];
      document.querySelectorAll('.schedule td.selected').forEach(cell => {
        const row = cell.parentElement;
        const time = row.querySelector('td:first-child').innerText;
        const dayIndex = [...cell.parentElement.children].indexOf(cell);
        const day = document.querySelector(`.schedule thead tr th:nth-child(${dayIndex+1})`).innerText;
        selected.push({ day, time });
      });

      if(selected.length === 0){
        alert("請至少選擇一個時段！");
        return;
      }

      const bookingData = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        phone: document.getElementById("phone").value,
        message: document.getElementById("message").value,
        slots: selected,
        timestamp: new Date().toLocaleString()
      };

      allBookings.push(bookingData);

      // 更新表格
      renderBookingTable();

      // 生成 CSV 並下載
      const csvContent = convertToCSV(allBookings);
      const blob = new Blob([csvContent], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `booking_${new Date().getTime()}.csv`;
      a.click();
      URL.revokeObjectURL(url);

      // 清空表單與已選時段
      this.reset();
      document.querySelectorAll('.schedule td.selected').forEach(cell => cell.classList.remove('selected'));
      alert("CSV 已生成並下載完成，並更新預約列表！");
    });
  </script>
</body>
</html>


