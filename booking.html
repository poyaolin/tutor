<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>預約試教時段</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* 行事曆格子樣式 */
    .schedule {
      margin-top: 1.5rem;
      overflow-x: auto;
    }
    .schedule table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 0 6px rgba(0,0,0,0.05);
    }
    .schedule th, .schedule td {
      border: 1px solid #ddd;
      padding: 0.75rem;
      text-align: center;
      cursor: pointer;
    }
    .schedule th {
      background-color: #f5f5f5;
    }
    .schedule td.available:hover {
      background: #e8eaf6;
    }
    .schedule td.selected {
      background: #3f51b5;
      color: #fff;
      font-weight: bold;
    }
    .form-card {
      margin-top: 2rem;
      background: #fff;
      padding: 1.5rem;
      box-shadow: 0 0 6px rgba(0,0,0,0.05);
      border-radius: 6px;
    }
    .form-card label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }
    .form-card input, 
    .form-card textarea {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
    }
    .submit-btn {
      margin-top: 1rem;
      background: #3f51b5;
      color: #fff;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <h1>家教平台</h1>
      <ul>
        <li><a href="index.html">首頁</a></li>
        <li><a href="about.html">關於我們</a></li>
        <li><a href="pricing.html">收費方案</a></li>
        <li><a href="booking.html" class="active">預約試教</a></li>
        <li><a href="contact.html">聯絡我</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h2>選擇試教時段</h2>
    <p>請點選以下表格中的可預約時段，並填寫基本資料：</p>

    <!-- 行事曆 -->
    <div class="schedule">
      <table>
        <thead>
          <tr>
            <th>時間</th>
            <th>週一</th>
            <th>週二</th>
            <th>週三</th>
            <th>週四</th>
            <th>週五</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>09:00 - 10:00</td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
          </tr>
          <tr>
            <td>10:00 - 11:00</td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
          </tr>
          <tr>
            <td>11:00 - 12:00</td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
          </tr>
          <tr>
            <td>12:00 - 13:00</td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
          </tr>
          <tr>
            <td>13:00 - 14:00</td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
          </tr>
          <tr>
            <td>14:00 - 15:00</td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
          </tr>
          <tr>
            <td>15:00 - 16:00</td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
          </tr>
          <tr>
            <td>16:00 - 17:00</td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
          </tr>
          <tr>
            <td>17:00 - 18:00</td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
          </tr>
          <tr>
            <td>18:00 - 19:00</td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
          </tr>
          <tr>
            <td>19:00 - 20:00</td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
          </tr>
          <tr>
            <td>20:00 - 21:00</td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
            <td class="available"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- 學生資訊表單 -->
    <div class="form-card">
      <form id="bookingForm">
        <label for="name">姓名：</label>
        <input type="text" id="name" name="name" required>

        <label for="email">Email：</label>
        <input type="email" id="email" name="email" required>

        <label for="phone">電話：</label>
        <input type="tel" id="phone" name="phone" required>

        <label for="message">備註：</label>
        <textarea id="message" name="message" rows="3"></textarea>

        <button type="submit" class="submit-btn">送出預約</button>
      </form>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 家教平台. All rights reserved.</p>
  </footer>

  <script>
    // 點擊切換已選時段
    document.querySelectorAll('.schedule td.available').forEach(cell => {
      cell.addEventListener('click', () => {
        cell.classList.toggle('selected');
      });
    });

    // 表單送出（以 JSON 傳到後端）
    document.getElementById("bookingForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      const selected = [];
      document.querySelectorAll('.schedule td.selected').forEach(cell => {
        const row = cell.parentElement;
        const time = row.querySelector('td:first-child').innerText;
        const dayIndex = [...cell.parentElement.children].indexOf(cell);
        const day = document.querySelector(`.schedule thead tr th:nth-child(${dayIndex+1})`).innerText;
        selected.push({ day, time });
      });

      if (selected.length === 0) {
        alert("請至少選擇一個時段！");
        return;
      }

      const data = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        phone: document.getElementById("phone").value,
        message: document.getElementById("message").value,
        slots: selected
      };

      const submitBtn = this.querySelector(".submit-btn");
      submitBtn.disabled = true;
      submitBtn.innerText = "送出中...";

      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbw2gB-bSELYGEPspL_mgRGvAnqn1nrN311yRRpxYfgQRvjcBxwxQMLCwqCDF-zLUauC/exec", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.status === "success") {
          alert(result.message);
          this.reset();
          document.querySelectorAll('.schedule td.selected').forEach(cell => cell.classList.remove('selected'));
        } else {
          alert("預約失敗：" + result.message);
        }
      } catch (error) {
        console.error("Error:", error);
        alert("連線錯誤，請檢查網路或伺服器設定。");
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerText = "送出預約";
      }
    });
  </script>
</body>
</html>
